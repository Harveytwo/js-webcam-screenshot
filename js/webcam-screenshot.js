/*! js-webcam-screenshot v0.1.0, 2014-05-13 */
!function(a,b){"use strict";function c(b,c,d,e){var f,g;switch(e){case"jpg":f="image/jpeg",g="image.jpg";break;case"png":default:f="image/png",g="image.png"}var h,i,j=function(a){b.append(c,a,g)};for(i=["getAsFile","getAsBlob","webkitGetAsFile","webkitGetAsBlob","mozGetAsFile","mozGetAsBlob","msGetAsFile","msGetAsBlob"],h=0;h<i.length;h++)if(d[i[h]])return void j(d[i[h]](g));var k,l=d.toDataURL(f).split(",");k=l[0].indexOf("base64")>=0?a.atob(l[1]):a.unescape(l[1]);var m=k.length;if(a.Blob){var n=new Array(m);for(h=0;m>h;h++)n[h]=k.charCodeAt(h);j(new a.Blob([new a.Uint8Array(n)],{type:f}))}else{var o=new a.ArrayBuffer(m),p=new a.Uint8Array(o);for(h=0;m>h;h++)p[h]=k.charCodeAt(h);var q=new a.BlobBuilder;q.append(o),j(q.getBlob(f))}}function d(e,g){if(g||(g=function(){}),!f)return void g(d.RC.UNSUPPORTED_BROWSER,"Browser is not supported");e=b.extend(!0,{parent:a.document.body,width:300,cancelText:"Cancel",takeText:"Take it"},e||{});var h,i=a.document.createElement("video"),j=b('<div class="webcamscreenshot-shadow" />'),k=b('<div class="webcamscreenshot-dialog" />'),l=null,m=null,n=function(){j.css({width:b(a).width(),height:b(a).height()}),k.css("left",(b(a).width()-e.width)/2+"px")},o=function(){if(b(a).off("resize",n),k.remove(),j.remove(),m){try{m.stop()}catch(c){}m=null}};b(a).on("resize",n),n(),k.append(i).append(h=b('<div class="webcamscreenshot-buttons" />')),b(e.parent).append(j),i.addEventListener("canplay",function(){l=Math.ceil(e.width*i.videoHeight/i.videoWidth),i.setAttribute("width",e.width),i.setAttribute("height",l)},!1),a.navigator._webcamScreenshotgetUserMedia({video:!0,audio:!1},function(f){if(b(e.parent).append(k),m=f,a.navigator.mozGetUserMedia)i.mozSrcObject=m;else{var j=a.URL||a.webkitURL;i.src=j&&j.createObjectURL?j.createObjectURL(m):m}i.play(),h.append(b("<button />").html(e.takeText).on("click",function(){var f;if(e.canvas){var h=[];for(h=e.canvas instanceof b?e.canvas:e.canvas instanceof Array?e.canvas:[e.canvas],f=0;f<h.length;f++)h[f].setAttribute("width",e.width),h[f].setAttribute("height",l),h[f].getContext("2d").drawImage(i,0,0,e.width,l)}if(e.postTo){var j=a.document.createElement("canvas"),k=new a.FormData;if(j.setAttribute("width",e.width),j.setAttribute("height",l),j.getContext("2d").drawImage(i,0,0,e.width,l),c(k,e.postFieldname||d.DEFAULT_POST_FIELDNAME,j,e.postImageFormat),e.onBeforePost)try{e.onBeforePost(k)}catch(m){return o(),void g(d.RC.SAVE_CALLBACKERROR,m.message||m.name||m.toString())}return void b.ajax({url:e.postTo,data:k,cache:!1,contentType:!1,processData:!1,type:"POST"}).fail(function(b,c,d){a.alert(d)}).success(function(){o(),g(d.RC.OK)})}o(),g(d.RC.OK)})).append(b("<button />").html(e.cancelText).on("click",function(){o(),g(d.RC.USER_CANCELLED,"User cancelled")}))},function(a){o(),g(d.RC.CANT_ACCESS_WEBCAM,a.message||a.name||a.toString())})}var e=a.navigator.getUserMedia||a.navigator.webkitGetUserMedia||a.navigator.mozGetUserMedia||a.navigator.msGetUserMedia||null;e&&(a.navigator._webcamScreenshotgetUserMedia=e);var f=e&&a.FormData?!0:!1;d.getIsSpported=function(){return f},d.VERSION="0.1.0",d.DEFAULT_POST_FIELDNAME="image",d.RC={OK:0,USER_CANCELLED:1,UNSUPPORTED_BROWSER:2,CANT_ACCESS_WEBCAM:3,SAVE_CALLBACKERROR:4,SAVE_FAILED:5},a.WebcamScreenshot=d}(window,jQuery);